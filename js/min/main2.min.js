$(document).ready(function(){function t(t){var e=[],o=1/0,n=-1/0;for(var i in t.features){var a=t.features[i].properties;for(var r in a)"city"!=r&&"lat"!=r&&"lon"!=r&&"dist"!=r&&"id"!=r&&(-1===$.inArray(r,e)&&e.push(r),a[r]<o&&(o=a[r]),a[r]>n&&(n=a[r]))}return{timestamps:e,min:o,max:n}}function e(t,e){l=L.geoJson(e,{pointToLayer:function(t,e){return L.circleMarker(e,{fillColor:"#008200",color:"#003100",weight:1,fillOpacity:.6}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"#33331A"})},mouseout:function(){this.closePopup(),this.setStyle({color:"#537898"})}})}}).addTo(d),o(t[0])}function o(t){l.eachLayer(function(e){var o=e.feature.properties,i=n(o[t]),a="<b>$"+String(o[t])+"</b><br><i>"+o.city+"</i> in </i>"+t+"</i>";e.setRadius(i),e.bindPopup(a,{offset:new L.Point(0,-i)})})}function n(t){var e=200,o=9*(t-582)/551*e;return Math.sqrt(o/Math.PI)}function i(t,e){function o(t){return 50*Math.round(t/50)}600>t&&(t=600);var i=L.control({position:"bottomright"});i.onAdd=function(){var i,a,r,l=L.DomUtil.create("div","legend"),d=L.DomUtil.create("div","symbolsContainer"),s=[o(t),o(e-200),o(e)],u=0;L.DomEvent.addListener(l,"mousedown",function(t){L.DomEvent.stopPropagation(t)}),$(l).append("<h2 id='legendTitle'>Median Rent per Month</h2>");for(var p=0;p<=s.length-1;p++)i=L.DomUtil.create("div","legendCircle"),a=n(s[p]),r=-a-u-2,$(i).attr("style","width: "+2*a+"px; height: "+2*a+"px; margin-left: "+r+"px"),$(i).append("<span class='legendValue'>"+s[p]+"<span>"),$(d).append(i),u=a;return $(l).append(d),l},i.addTo(d)}function a(t){var e=L.control({position:"bottomleft"});e.onAdd=function(){var e=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(e,"mousedown",function(t){L.DomEvent.stopPropagation(t)}),$(e).attr({type:"range",max:t.length-1,min:0,step:1,value:0}).on("input change",function(){o(t[$(this).val()]),$(".temporal-legend").text(t[this.value])}),e},e.addTo(d),r(t[0])}function r(t){var e=L.control({position:"bottomleft"});e.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return $(e).text(t),e},e.addTo(d)}var l,d=L.map("map",{center:[43,-89.4],zoom:7,minZoom:6,maxZoom:8});L.tileLayer("http://api.tiles.mapbox.com/v4/umeuwe.jm028goe/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidW1ldXdlIiwiYSI6ImhCMUlHUGsifQ.oKR3yAbedOdOwOCalLly6A",{attribution:"Custom tileset from Tilemill"}).addTo(d),$.getJSON("data/MAP.json").done(function(o){var n=t(o);e(n.timestamps,o),i(n.min,n.max),a(n.timestamps)}).fail(function(){alert("There has been a problem loading the data.")})});