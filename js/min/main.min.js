$(document).ready(function(){function t(t){var e=[],n=1/0,o=-1/0;for(var i in t.features){var a=t.features[i].properties;for(var r in a)"city"!=r&&"lat"!=r&&"lon"!=r&&"dist"!=r&&"id"!=r&&(-1===$.inArray(r,e)&&e.push(r),a[r]<n&&(n=a[r]),a[r]>o&&(o=a[r]))}return{timestamps:e,min:n,max:o};var i,a,r}function e(t,e){s=L.geoJson(e,{pointToLayer:function(t,e){return L.circleMarker(e,{fillColor:"black",color:"black",weight:2,fillOpacity:.3}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"#FF9900",weight:5,fillopacity:.6})},mouseout:function(){this.closePopup(),this.setStyle({color:"black",weight:2})}})}}).addTo(c),n(t[0])}function n(t){s.eachLayer(function(e){var n=e.feature.properties,i=o(n[t]),a="<b>"+n.city+"</b><br><i>$"+String(n[t])+"</i> in </i>"+t+"</i>";e.setRadius(i),e.bindPopup(a,{offset:new L.Point(0,-i)})})}function o(t){var e=200,n=9*(t-582)/418*e;return Math.sqrt(n/Math.PI)}function i(t,e){function n(t){return 25*Math.round(t/25)}600>t&&(t=600);var i=L.control({position:"bottomright"});i.onAdd=function(){var i,a,r,l=L.DomUtil.create("div","legend"),s=L.DomUtil.create("div","symbolsContainer"),u=[n(t),n(e-200),n(e)],d=0;L.DomEvent.addListener(l,"mousedown",function(t){L.DomEvent.stopPropagation(t)}),$(l).append("<h2 id='legendTitle'>Median Rent per Month</h2>");for(var p=0;p<=u.length-1;p++)i=L.DomUtil.create("div","legendCircle"),a=o(u[p]),r=-a-d-2,$(i).attr("style","width: "+2*a+"px; height: "+2*a+"px; margin-left: "+r+"px"),$(i).append("<span class='legendValue'>"+u[p]+"<span>"),$(s).append(i),d=a;return $(l).append(s),l},i.addTo(c)}function a(t){var e=L.control({position:"bottomleft"});e.onAdd=function(){var e=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(e,"mousedown",function(t){L.DomEvent.stopPropagation(t)}),$(e).attr({type:"range",max:t.length-1,min:0,step:1,value:8}).on("input change",function(){n(t[$(this).val()]),$(".temporal-legend").text(t[this.value])}),e},e.addTo(c),r(t[8])}function r(t){var e=L.control({position:"bottomleft"});e.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return $(e).text(t),e},e.addTo(c)}function l(){var t=L.control({position:"topright"});t.onAdd=function(){var t=L.DomUtil.create("input","price-slider");return L.DomEvent.addListener(t,"mousedown",function(t){L.DomEvent.stopPropagation(t)}),$(t).attr({type:"range",max:1e3,min:500,step:25,value:1e3}).on("input change",function(){n(timestamps[$(this).val()]),$(".price-legend").text(timestamps[this.value])}),t},t.addTo(c),r(timestamps[0])}var s,u=L.latLng(37,-95),d=L.latLng(48,-81.5),p=L.latLngBounds(u,d),c=L.map("map",{center:[43,-89.4],zoom:7,minZoom:6,maxZoom:8,maxBounds:p});c.fitBounds(p),L.tileLayer("http://api.tiles.mapbox.com/v4/umeuwe.wdx11yvi/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidW1ldXdlIiwiYSI6ImhCMUlHUGsifQ.oKR3yAbedOdOwOCalLly6A",{attribution:"Tileset built in Tilemill, Rent data from US Census Bureau, Inflation calculated with usinflationcalculator.com"}).addTo(c),$.getJSON("data/MAP.json").done(function(n){var o=t(n);e(o.timestamps,n),i(o.min,o.max),a(o.timestamps),l(o.timestamps)}).fail(function(){alert("There has been a problem loading the data.")})});